<div class="discover-container">
  <!-- Header -->
  <div class="discover-header">
    <h1>{{ domainConfig.domainLabel }}</h1>
  </div>

  <hr/>

  <!-- Query Control Panel (verified working) -->
  <div class="panel-wrapper">
    <div class="panel-header">
      <div class="panel-title-group">
        <h3 class="panel-title">Query Control</h3>
      </div>
      <div class="panel-actions">
        <button
          *ngIf="!isPanelPoppedOut('query-control')"
          pButton
          type="button"
          icon="pi pi-external-link"
          class="p-button-sm p-button-text p-button-rounded"
          (click)="popOutPanel('query-control', 'query-control')"
          pTooltip="Pop out to separate window"
          tooltipPosition="left">
        </button>
      </div>
    </div>
    <div *ngIf="!isPanelPoppedOut('query-control'); else queryControlPlaceholder">
      <app-query-control
        [domainConfig]="domainConfig"
        (urlParamsChange)="onUrlParamsChange($event)"
        (clearAllFilters)="onClearAllFilters()">
      </app-query-control>
    </div>
    <ng-template #queryControlPlaceholder>
      <div class="popout-placeholder">
        <i class="pi pi-external-link"></i>
        <span>Query Control is open in a separate window</span>
      </div>
    </ng-template>
  </div>

  <!-- Manufacturer-Model Picker Panel (verified working) -->
  <div class="panel-wrapper">
    <div class="panel-header">
      <div class="panel-title-group">
        <h3 class="panel-title">Manufacturer-Model Picker</h3>
      </div>
      <div class="panel-actions">
        <button
          *ngIf="!isPanelPoppedOut('manufacturer-model-picker')"
          pButton
          type="button"
          icon="pi pi-external-link"
          class="p-button-sm p-button-text p-button-rounded"
          (click)="popOutPanel('manufacturer-model-picker', 'picker')"
          pTooltip="Pop out to separate window"
          tooltipPosition="left">
        </button>
      </div>
    </div>
    <div *ngIf="!isPanelPoppedOut('manufacturer-model-picker'); else pickerPlaceholder">
      <app-base-picker
        [configId]="'manufacturer-model-picker'"
        (selectionChange)="onPickerSelectionChangeAndUpdateUrl($event)">
      </app-base-picker>
    </div>
    <ng-template #pickerPlaceholder>
      <div class="popout-placeholder">
        <i class="pi pi-external-link"></i>
        <span>Manufacturer-Model Picker is open in a separate window</span>
      </div>
    </ng-template>
  </div>

  <!-- Results Table Panel (ISOLATED FOR TESTING) -->
  <div class="panel-wrapper">
    <div class="panel-header">
      <div class="panel-title-group">
        <h3 class="panel-title">Results Table</h3>
      </div>
      <div class="panel-actions">
        <button
          *ngIf="!isPanelPoppedOut('results-table')"
          pButton
          type="button"
          icon="pi pi-external-link"
          class="p-button-sm p-button-text p-button-rounded"
          (click)="popOutPanel('results-table', 'results')"
          pTooltip="Pop out to separate window"
          tooltipPosition="left">
        </button>
      </div>
    </div>

    <!-- Panel Content -->
    <div *ngIf="!isPanelPoppedOut('results-table'); else resultsPlaceholder">
      <app-results-table
        [domainConfig]="domainConfig">
      </app-results-table>
    </div>
    <ng-template #resultsPlaceholder>
      <div class="popout-placeholder">
        <i class="pi pi-external-link"></i>
        <span>Results Table is open in a separate window</span>
      </div>
    </ng-template>
  </div>

  <!-- Statistics Panel (ISOLATED FOR TESTING) -->
  <div class="panel-wrapper">
    <div class="panel-header">
      <div class="panel-title-group">
        <h3 class="panel-title">Statistics</h3>
      </div>
      <div class="panel-actions">
        <button
          *ngIf="!isPanelPoppedOut('statistics-panel')"
          pButton
          type="button"
          icon="pi pi-external-link"
          class="p-button-sm p-button-text p-button-rounded"
          (click)="popOutPanel('statistics-panel', 'statistics')"
          pTooltip="Pop out to separate window"
          tooltipPosition="left">
        </button>
      </div>
    </div>
    <div *ngIf="!isPanelPoppedOut('statistics-panel'); else statisticsPlaceholder">
      <app-statistics-panel
        [domainConfig]="domainConfig">
      </app-statistics-panel>
    </div>
    <ng-template #statisticsPlaceholder>
      <div class="popout-placeholder">
        <i class="pi pi-external-link"></i>
        <span>Statistics is open in a separate window</span>
      </div>
    </ng-template>
  </div>

  <hr/>

  <!-- DEBUG: Current URL State -->
  <div class="debug-panel">
    <h4>Debug: URL State</h4>
    <pre>{{ debugUrlState }}</pre>
  </div>

</div>
