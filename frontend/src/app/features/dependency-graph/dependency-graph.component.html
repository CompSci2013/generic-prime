<div class="dependency-graph-container">
  <!-- Header -->
  <div class="header">
    <h1>üîó Generic-Prime Dependency Graph</h1>
    <p class="subtitle">Comprehensive DAG visualization of all application dependencies</p>
  </div>

  <!-- Statistics Bar -->
  <div class="stats-bar">
    <div class="stat-item">
      <strong>{{ stats.totalNodes }}</strong> Nodes
    </div>
    <div class="stat-item">
      <strong>{{ stats.totalEdges }}</strong> Dependency Edges
    </div>
    <div class="stat-item">
      <strong>{{ stats.npmDependencies }}</strong> NPM Packages
    </div>
    <div class="stat-item">
      <strong>{{ stats.frameworkServices }}</strong> Services
    </div>
    <div class="stat-item">
      <strong>{{ stats.frameworkComponents }}</strong> Components
    </div>
    <div class="stat-item">
      <strong>{{ stats.buildTools }}</strong> Build Tools
    </div>
    <div class="stat-item">
      <strong>{{ stats.testingTools }}</strong> Test Tools
    </div>
  </div>

  <!-- Controls Panel -->
  <div class="controls-panel">
    <!-- Search Controls -->
    <div class="control-group search-group">
      <input
        type="text"
        [(ngModel)]="searchText"
        (ngModelChange)="filterBySearch()"
        placeholder="Search dependencies..."
        class="search-input"
        />
      <button (click)="clearSearch()" class="btn btn-clear">Clear</button>
    </div>

    <!-- Zoom Controls -->
    <div class="control-group zoom-group">
      <button (click)="zoomOut()" class="btn btn-zoom" title="Zoom Out">‚àí</button>
      <button (click)="fitToView()" class="btn btn-zoom" title="Fit to View">‚ä°</button>
      <button (click)="zoomIn()" class="btn btn-zoom" title="Zoom In">+</button>
    </div>

    <!-- Toggle Controls -->
    <div class="control-group toggle-group">
      <button
        (click)="toggleLegend()"
        [class.active]="showLegend"
        class="btn btn-toggle"
        title="Toggle Legend"
        >
        ‚óÜ Legend
      </button>
      <button
        (click)="toggleFilters()"
        [class.active]="showFilters"
        class="btn btn-toggle"
        title="Toggle Filters"
        >
        ‚äû Filters
      </button>
    </div>

    <!-- Action Controls -->
    <div class="control-group action-group">
      <button (click)="resetView()" class="btn btn-action" title="Reset View">üîÑ Reset</button>
      <button (click)="exportAsJson()" class="btn btn-action" title="Export as JSON">‚¨á Export</button>
    </div>
  </div>

  <!-- Main Content Area -->
  <div class="content-wrapper">
    <!-- Left Sidebar - Filters -->
    @if (showFilters) {
      <div class="sidebar" [@fadeInOut]>
        <div class="sidebar-header">
          <h3>Category Filters</h3>
        </div>
        <div class="filter-list">
          @for (filter of categoryFilters; track filter) {
            <div
              class="filter-item"
              (click)="toggleCategory(filter.category)"
              >
              <div class="filter-checkbox">
                <input
                  type="checkbox"
                  [checked]="filter.visible"
                  (change)="toggleCategory(filter.category)"
                  [id]="'filter-' + filter.category"
                  />
                <label [for]="'filter-' + filter.category"></label>
              </div>
              <span class="filter-color" [style.background-color]="filter.color"></span>
              <span class="filter-label">{{ filter.label }}</span>
            </div>
          }
        </div>
      </div>
    }

    <!-- Graph Canvas -->
    <div class="graph-wrapper">
      <div #cyContainer class="cy-container"></div>
    </div>

    <!-- Right Sidebar - Node Details -->
    <div class="sidebar info-panel" [class.has-content]="selectedNode" [@fadeInOut]>
      @if (selectedNode) {
        <div class="node-details">
          <h3>{{ selectedNode.label }}</h3>
          <div class="detail-row">
            <strong>ID:</strong>
            <span class="code">{{ selectedNode.id }}</span>
          </div>
          <div class="detail-row">
            <strong>Category:</strong>
            <span class="category-badge" [style.background-color]="getNodeColor(selectedNode.category)">
              {{ selectedNode.category }}
            </span>
          </div>
          @if (selectedNode.version) {
            <div class="detail-row">
              <strong>Version:</strong>
              <span class="code">{{ selectedNode.version }}</span>
            </div>
          }
          @if (selectedNode.description) {
            <div class="detail-row description">
              <strong>Description:</strong>
              <p>{{ selectedNode.description }}</p>
            </div>
          }
        </div>
      } @else {
        <div class="no-selection">
          <p>üëÜ Click on a node to view details</p>
        </div>
      }
    </div>
  </div>

  <!-- Legend -->
  @if (showLegend) {
    <div class="legend-compact" [@fadeInOut]>
      <div class="legend-header" (click)="toggleLegendExpanded()">
        <h4>üìã Legend <span class="toggle-icon">{{ legendExpanded ? '‚ñº' : '‚ñ∂' }}</span></h4>
      </div>
      @if (legendExpanded) {
        <div class="legend-content">
          <div class="legend-section compact">
            <h5>Node Types (12)</h5>
            <div class="legend-grid compact">
              <div class="legend-item"><div class="legend-color" style="background-color: #DD0031"></div><span>Angular</span></div>
              <div class="legend-item"><div class="legend-color" style="background-color: #3776AB"></div><span>Prod Deps</span></div>
              <div class="legend-item"><div class="legend-color" style="background-color: #C7CEEA"></div><span>Services</span></div>
              <div class="legend-item"><div class="legend-color" style="background-color: #F8B195"></div><span>Components</span></div>
              <div class="legend-item"><div class="legend-color" style="background-color: #B4A7D6"></div><span>Features</span></div>
              <div class="legend-item"><div class="legend-color" style="background-color: #95E1D3"></div><span>Models</span></div>
              <div class="legend-item"><div class="legend-color" style="background-color: #FFD93D"></div><span>Config</span></div>
              <div class="legend-item"><div class="legend-color" style="background-color: #6BCB77"></div><span>Adapters</span></div>
              <div class="legend-item"><div class="legend-color" style="background-color: #A8E6CF"></div><span>Charts</span></div>
              <div class="legend-item"><div class="legend-color" style="background-color: #E8DAEF"></div><span>Build</span></div>
              <div class="legend-item"><div class="legend-color" style="background-color: #D7BDE2"></div><span>Testing</span></div>
              <div class="legend-item"><div class="legend-color" style="background-color: #F5B7B1"></div><span>External</span></div>
            </div>
          </div>
          <div class="legend-section compact">
            <h5>Edges (5)</h5>
            <div class="legend-items compact">
              <div><span class="edge-sample uses"></span><span>Uses</span></div>
              <div><span class="edge-sample implements"></span><span>Impl</span></div>
              <div><span class="edge-sample extends"></span><span>Ext</span></div>
              <div><span class="edge-sample provides"></span><span>Prov</span></div>
              <div><span class="edge-sample injects"></span><span>Inj</span></div>
            </div>
          </div>
          <div class="legend-section compact">
            <h5>Keyboard</h5>
            <ul class="legend-help compact">
              <li><strong>Click:</strong> Select node</li>
              <li><strong>Drag:</strong> Pan graph</li>
              <li><strong>Scroll:</strong> Zoom</li>
            </ul>
          </div>
        </div>
      }
    </div>
  }

  <!-- Node Details Modal/Popover -->
  @if (selectedNode) {
    <div class="node-modal" [@fadeInOut]
      (mousemove)="onModalMouseMove($event)"
      (mouseleave)="onModalMouseUp()"
      (mouseup)="onModalMouseUp()">
      <div class="modal-backdrop" (click)="selectedNode = null"></div>
      <div class="modal-content" [style]="getModalStyle()"
        (mousedown)="onModalMouseDown($event)">
        <button class="modal-close" (click)="selectedNode = null">&times;</button>
        <div class="modal-header" (mousedown)="onModalMouseDown($event)">
          <div class="drag-handle" title="Drag to move window">‚ãÆ‚ãÆ</div>
          <div class="header-content">
            <h2>{{ selectedNode.label }}</h2>
            <span class="modal-category" [style.background-color]="getNodeColor(selectedNode.category)">
              {{ selectedNode.category }}
            </span>
          </div>
        </div>
        <div class="modal-body">
          <div class="modal-section">
            <h4>Overview</h4>
            @if (selectedNode.description) {
              <p>{{ selectedNode.description }}</p>
            } @else {
              <p class="no-info">No description available</p>
            }
          </div>
          @if (selectedNode.detailedDescription) {
            <div class="modal-section">
              <h4>Details</h4>
              <p class="detailed-text">{{ selectedNode.detailedDescription }}</p>
            </div>
          }
          @if (selectedNode.methods && selectedNode.methods.length > 0) {
            <div class="modal-section">
              <h4>Public Methods</h4>
              <ul class="methods-list">
                @for (method of selectedNode.methods; track method) {
                  <li>{{ method }}</li>
                }
              </ul>
            </div>
          }
          @if (selectedNode.observables && selectedNode.observables.length > 0) {
            <div class="modal-section">
              <h4>Observable Streams</h4>
              <ul class="observables-list">
                @for (obs of selectedNode.observables; track obs) {
                  <li><code>{{ obs }}</code></li>
                }
              </ul>
            </div>
          }
          @if (selectedNode.version) {
            <div class="modal-section">
              <h4>Version</h4>
              <code>{{ selectedNode.version }}</code>
            </div>
          }
          <div class="modal-section">
            <h4>Technical ID</h4>
            <code>{{ selectedNode.id }}</code>
          </div>
          <div class="modal-section">
            <h4>Category Details</h4>
            <p class="category-info">
              @if (selectedNode.category.includes('npm')) {
                <span>üì¶ NPM Package</span>
              }
              @if (selectedNode.category.includes('Service')) {
                <span>‚öôÔ∏è Framework Service</span>
              }
              @if (selectedNode.category.includes('Component')) {
                <span>üé® UI Component</span>
              }
              @if (selectedNode.category.includes('Feature')) {
                <span>‚ú® Feature Component</span>
              }
              @if (selectedNode.category.includes('Model')) {
                <span>üìã Model/Interface</span>
              }
              @if (selectedNode.category.includes('Domain')) {
                <span>üîß Domain Configuration</span>
              }
              @if (selectedNode.category.includes('Adapter')) {
                <span>üîå Domain Adapter</span>
              }
              @if (selectedNode.category.includes('Chart')) {
                <span>üìä Chart Data Source</span>
              }
              @if (selectedNode.category.includes('Build')) {
                <span>üèóÔ∏è Build Tool</span>
              }
              @if (selectedNode.category.includes('Test')) {
                <span>üß™ Testing/Linting Tool</span>
              }
              @if (selectedNode.category.includes('External')) {
                <span>üåê External Library</span>
              }
            </p>
          </div>
        </div>
      </div>
    </div>
  }

  <!-- Footer -->
  <div class="footer">
    <p>
      Generic-Prime Dependency Graph ‚Ä¢ Generated: {{ currentDate | date: 'short' }} ‚Ä¢
      {{ stats.npmDependencies }} NPM packages, {{ stats.frameworkServices }} services,
      {{ stats.frameworkComponents }} framework components
    </p>
  </div>
</div>
