<div class="dependency-graph-container">
  <!-- Header -->
  <div class="header">
    <h1>ğŸ”— Generic-Prime Dependency Graph</h1>
    <p class="subtitle">Comprehensive DAG visualization of all application dependencies</p>
  </div>

  <!-- Statistics Bar -->
  <div class="stats-bar">
    <div class="stat-item">
      <strong>{{ stats.totalNodes }}</strong> Nodes
    </div>
    <div class="stat-item">
      <strong>{{ stats.totalEdges }}</strong> Dependency Edges
    </div>
    <div class="stat-item">
      <strong>{{ stats.npmDependencies }}</strong> NPM Packages
    </div>
    <div class="stat-item">
      <strong>{{ stats.frameworkServices }}</strong> Services
    </div>
    <div class="stat-item">
      <strong>{{ stats.frameworkComponents }}</strong> Components
    </div>
    <div class="stat-item">
      <strong>{{ stats.buildTools }}</strong> Build Tools
    </div>
    <div class="stat-item">
      <strong>{{ stats.testingTools }}</strong> Test Tools
    </div>
  </div>

  <!-- Controls Panel -->
  <div class="controls-panel">
    <!-- Search Controls -->
    <div class="control-group search-group">
      <input
        type="text"
        [(ngModel)]="searchText"
        (ngModelChange)="filterBySearch()"
        placeholder="Search dependencies..."
        class="search-input"
      />
      <button (click)="clearSearch()" class="btn btn-clear">Clear</button>
    </div>

    <!-- Zoom Controls -->
    <div class="control-group zoom-group">
      <button (click)="zoomOut()" class="btn btn-zoom" title="Zoom Out">âˆ’</button>
      <button (click)="fitToView()" class="btn btn-zoom" title="Fit to View">âŠ¡</button>
      <button (click)="zoomIn()" class="btn btn-zoom" title="Zoom In">+</button>
    </div>

    <!-- Toggle Controls -->
    <div class="control-group toggle-group">
      <button
        (click)="toggleLegend()"
        [class.active]="showLegend"
        class="btn btn-toggle"
        title="Toggle Legend"
      >
        â—† Legend
      </button>
      <button
        (click)="toggleFilters()"
        [class.active]="showFilters"
        class="btn btn-toggle"
        title="Toggle Filters"
      >
        âŠ Filters
      </button>
    </div>

    <!-- Action Controls -->
    <div class="control-group action-group">
      <button (click)="resetView()" class="btn btn-action" title="Reset View">ğŸ”„ Reset</button>
      <button (click)="exportAsJson()" class="btn btn-action" title="Export as JSON">â¬‡ Export</button>
    </div>
  </div>

  <!-- Main Content Area -->
  <div class="content-wrapper">
    <!-- Left Sidebar - Filters -->
    <div class="sidebar" *ngIf="showFilters" [@fadeInOut]>
      <div class="sidebar-header">
        <h3>Category Filters</h3>
      </div>
      <div class="filter-list">
        <div
          *ngFor="let filter of categoryFilters"
          class="filter-item"
          (click)="toggleCategory(filter.category)"
        >
          <div class="filter-checkbox">
            <input
              type="checkbox"
              [checked]="filter.visible"
              (change)="toggleCategory(filter.category)"
              [id]="'filter-' + filter.category"
            />
            <label [for]="'filter-' + filter.category"></label>
          </div>
          <span class="filter-color" [style.background-color]="filter.color"></span>
          <span class="filter-label">{{ filter.label }}</span>
        </div>
      </div>
    </div>

    <!-- Graph Canvas -->
    <div class="graph-wrapper">
      <div #cyContainer class="cy-container"></div>
    </div>

    <!-- Right Sidebar - Node Details -->
    <div class="sidebar info-panel" [class.has-content]="selectedNode" [@fadeInOut]>
      <div *ngIf="selectedNode; else noSelection" class="node-details">
        <h3>{{ selectedNode.label }}</h3>
        <div class="detail-row">
          <strong>ID:</strong>
          <span class="code">{{ selectedNode.id }}</span>
        </div>
        <div class="detail-row">
          <strong>Category:</strong>
          <span class="category-badge" [style.background-color]="getNodeColor(selectedNode.category)">
            {{ selectedNode.category }}
          </span>
        </div>
        <div *ngIf="selectedNode.version" class="detail-row">
          <strong>Version:</strong>
          <span class="code">{{ selectedNode.version }}</span>
        </div>
        <div *ngIf="selectedNode.description" class="detail-row description">
          <strong>Description:</strong>
          <p>{{ selectedNode.description }}</p>
        </div>
      </div>
      <ng-template #noSelection>
        <div class="no-selection">
          <p>ğŸ‘† Click on a node to view details</p>
        </div>
      </ng-template>
    </div>
  </div>

  <!-- Legend -->
  <div class="legend-compact" *ngIf="showLegend" [@fadeInOut]>
    <div class="legend-header" (click)="toggleLegendExpanded()">
      <h4>ğŸ“‹ Legend <span class="toggle-icon">{{ legendExpanded ? 'â–¼' : 'â–¶' }}</span></h4>
    </div>

    <div class="legend-content" *ngIf="legendExpanded">
      <div class="legend-section compact">
        <h5>Node Types (12)</h5>
        <div class="legend-grid compact">
          <div class="legend-item"><div class="legend-color" style="background-color: #DD0031"></div><span>Angular</span></div>
          <div class="legend-item"><div class="legend-color" style="background-color: #3776AB"></div><span>Prod Deps</span></div>
          <div class="legend-item"><div class="legend-color" style="background-color: #C7CEEA"></div><span>Services</span></div>
          <div class="legend-item"><div class="legend-color" style="background-color: #F8B195"></div><span>Components</span></div>
          <div class="legend-item"><div class="legend-color" style="background-color: #B4A7D6"></div><span>Features</span></div>
          <div class="legend-item"><div class="legend-color" style="background-color: #95E1D3"></div><span>Models</span></div>
          <div class="legend-item"><div class="legend-color" style="background-color: #FFD93D"></div><span>Config</span></div>
          <div class="legend-item"><div class="legend-color" style="background-color: #6BCB77"></div><span>Adapters</span></div>
          <div class="legend-item"><div class="legend-color" style="background-color: #A8E6CF"></div><span>Charts</span></div>
          <div class="legend-item"><div class="legend-color" style="background-color: #E8DAEF"></div><span>Build</span></div>
          <div class="legend-item"><div class="legend-color" style="background-color: #D7BDE2"></div><span>Testing</span></div>
          <div class="legend-item"><div class="legend-color" style="background-color: #F5B7B1"></div><span>External</span></div>
        </div>
      </div>

      <div class="legend-section compact">
        <h5>Edges (5)</h5>
        <div class="legend-items compact">
          <div><span class="edge-sample uses"></span><span>Uses</span></div>
          <div><span class="edge-sample implements"></span><span>Impl</span></div>
          <div><span class="edge-sample extends"></span><span>Ext</span></div>
          <div><span class="edge-sample provides"></span><span>Prov</span></div>
          <div><span class="edge-sample injects"></span><span>Inj</span></div>
        </div>
      </div>

      <div class="legend-section compact">
        <h5>Keyboard</h5>
        <ul class="legend-help compact">
          <li><strong>Click:</strong> Select node</li>
          <li><strong>Drag:</strong> Pan graph</li>
          <li><strong>Scroll:</strong> Zoom</li>
        </ul>
      </div>
    </div>
  </div>

  <!-- Node Details Modal/Popover -->
  <div class="node-modal" *ngIf="selectedNode" [@fadeInOut]
       (mousemove)="onModalMouseMove($event)"
       (mouseleave)="onModalMouseUp()"
       (mouseup)="onModalMouseUp()">
    <div class="modal-backdrop" (click)="selectedNode = null"></div>
    <div class="modal-content" [style]="getModalStyle()"
         (mousedown)="onModalMouseDown($event)">
      <button class="modal-close" (click)="selectedNode = null">&times;</button>
      <div class="modal-header">
        <h2>{{ selectedNode.label }}</h2>
        <span class="modal-category" [style.background-color]="getNodeColor(selectedNode.category)">
          {{ selectedNode.category }}
        </span>
      </div>
      <div class="modal-body">
        <div class="modal-section">
          <h4>Overview</h4>
          <p *ngIf="selectedNode.description; else noDescription">{{ selectedNode.description }}</p>
          <ng-template #noDescription>
            <p class="no-info">No description available</p>
          </ng-template>
        </div>

        <div class="modal-section" *ngIf="selectedNode.version">
          <h4>Version</h4>
          <code>{{ selectedNode.version }}</code>
        </div>

        <div class="modal-section">
          <h4>Technical ID</h4>
          <code>{{ selectedNode.id }}</code>
        </div>

        <div class="modal-section">
          <h4>Category Details</h4>
          <p class="category-info">
            <span *ngIf="selectedNode.category.includes('npm')">ğŸ“¦ NPM Package</span>
            <span *ngIf="selectedNode.category.includes('Service')">âš™ï¸ Framework Service</span>
            <span *ngIf="selectedNode.category.includes('Component')">ğŸ¨ UI Component</span>
            <span *ngIf="selectedNode.category.includes('Feature')">âœ¨ Feature Component</span>
            <span *ngIf="selectedNode.category.includes('Model')">ğŸ“‹ Model/Interface</span>
            <span *ngIf="selectedNode.category.includes('Domain')">ğŸ”§ Domain Configuration</span>
            <span *ngIf="selectedNode.category.includes('Adapter')">ğŸ”Œ Domain Adapter</span>
            <span *ngIf="selectedNode.category.includes('Chart')">ğŸ“Š Chart Data Source</span>
            <span *ngIf="selectedNode.category.includes('Build')">ğŸ—ï¸ Build Tool</span>
            <span *ngIf="selectedNode.category.includes('Test')">ğŸ§ª Testing/Linting Tool</span>
            <span *ngIf="selectedNode.category.includes('External')">ğŸŒ External Library</span>
          </p>
        </div>
      </div>
    </div>
  </div>

  <!-- Footer -->
  <div class="footer">
    <p>
      Generic-Prime Dependency Graph â€¢ Generated: {{ currentDate | date: 'short' }} â€¢
      {{ stats.npmDependencies }} NPM packages, {{ stats.frameworkServices }} services,
      {{ stats.frameworkComponents }} framework components
    </p>
  </div>
</div>
